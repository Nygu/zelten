define(["backbone","zelten/view/writestatus","zelten/view/modaldialog","zelten/view/userlink","zelten/model/message","timeago","bootstrap"],function(e,t,n,r,i){var s=e.View.extend({events:{"click a.show-conversation":"clickShowConversations","click a.show-reply":"clickReply","click a.repost":"clickRepost","click a.more-content":"showMoreContent","click a.favorite":"toggleFavorite","hover a.favorite":"hoverFavorite"},initialize:function(e){this.messages=e.messages,this.replyToView=new t({mentions:this.$el.data("mentions"),collection:e.messages,el:this.$el.find(".stream-message-add-replyto")})},hoverFavorite:function(e){var t=$(e.currentTarget).find("i");t.hasClass("icon-star-empty")?t.removeClass("icon-star-empty").addClass("icon-star"):t.addClass("icon-star-empty").removeClass("icon-star")},toggleFavorite:function(e){var t=$(e.currentTarget);return $.ajax({type:"POST",url:t.attr("href"),success:_.bind(this.toggleFavoriteSuccess,this,t)}),!1},toggleFavoriteSuccess:function(e,t){var n=parseInt(e.data("is-favorite"));n?(e.data("is-favorite",0).attr("title","Favorited"),e.find("i").addClass("icon-star-empty").removeClass("icon-star")):(e.data("is-favorite",1).attr("title","Favorite"),e.find("i").removeClass("icon-star-empty").addClass("icon-star"))},showMoreContent:function(e){return $(e.currentTarget).hide(),this.$el.find(".hidden-content").slideDown(),!1},clickReply:function(e){return this.$el.find(".reply-form").toggle(),!1},clickRepost:function(e){var t=new n({params:{title:"Do you want to repost this message?",post:this.$el.find(".message-body").html(),label:"Yes, repost!"},success:_.bind(this.confirmClickRepost,this,$(e.currentTarget).attr("href"))});return t.render(),!1},confirmClickRepost:function(e){return $.ajax({type:"POST",url:e,success:_.bind(this.repostSuccess,this)}),!1},repostSuccess:function(e){this.$el.find("a.repost").css("pointer-events","none");var t=$(e),n=new i({id:t.data("message-id"),entity:t.data("entity"),published:t.data("published"),element:t});this.messages&&this.messages.add(t)},clickShowConversations:function(e){var t=$(e.currentTarget);return this.$el.find(".conversation-pane").is(":hidden")?(this.$el.find("a.show-conversation").attr("disabled",!0).css("pointer-events","none"),$.ajax({url:t.attr("href"),success:_.bind(this.showConversation,this)}),this.$el.find(".conversation-pane").slideDown().addClass("loading")):this.$el.find(".conversation-pane").slideUp().removeClass("loading"),!1},showConversation:function(e){this.$el.find(".conversation-pane").removeClass("loading"),this.$el.find(".conversations").html(e);var t=this.$el.find(".conversations .conversation-message").length;this.$el.find("a.show-conversation").filter(".btn").append(" "+t),this.$el.find("a.show-conversation").attr("disabled",!1).css("pointer-events","auto"),this.$el.find(".conversations .timeago").timeago(),this.$el.find(".conversations").each(function(){var e=new r({el:$(this)});e.render()})},render:function(){this.$el.find(".show-tooltip").tooltip({}),this.$el.find(".show-popover").popover({placement:"bottom",trigger:"hover"}),this.$el.find(".timeago").timeago(),this.$el.find("a.user-details").each(function(){var e=new r({el:$(this)});e.render()}),this.replyToView.render()}});return s})