define(["backbone","zelten/model/message","jquery.autoresize","select2"],function(e,t){var n=e.View.extend({events:{click:"showActions","keyup .message":"showActions","change .message":"showActions","click .stream-message-add-cancel":"cancelPosting",submit:"writeMessage"},initialize:function(e){this.mentions=e.mentions||"",this.hasPermissions=this.$el.find(".complete-permissions").length>0},render:function(){this.$el.find("textarea").autoResize({extraSpace:0,animate:{duration:50,complete:function(){}}}),this.hasPermissions&&this.$el.find(".complete-permissions").select2({tags:["Everybody"]})},cancelPosting:function(){var e=this.$el.find(".actions");this.$el.find(".message").data("AutoResizer").config.extraSpace=0,this.$el.find(".message").css("height",30),e.slideUp()},writeMessage:function(e){var t=$(e.currentTarget),n=t.find(".message").val();return typeof n=="undefined"||n.length==0?!1:(t.find(".stream-message-add-btn").attr("disabled",!0),$.ajax({url:t.attr("action"),type:"POST",data:t.serialize(),success:_.bind(this.writeMessageSuccess,this)}),!1)},writeMessageSuccess:function(e){var n=$(e),r=new t({id:n.data("message-id"),entity:n.data("entity"),published:n.data("published"),element:n});this.collection.add(r),this.$el.find(".stream-message-add-btn").attr("disabled",!1),this.$el.each(function(){this.reset()}),this.cancelPosting()},showActions:function(){var e=this.$el.find(".actions"),t=this.$el.find(".message");e.is(":hidden")&&(e.slideDown(),this.hasPermissions&&this.$el.find(".complete-permissions").select2("data",{id:"public",text:"Everybody"}),this.$el.find(".message").css("height",60),t.data("AutoResizer").config.extraSpace=50,this.mentions.length>0&&this.$el.find(".message").val(this.mentions+" "));var n=t.val();this.$el.find(".stream-message-add-btn").attr("disabled",n.length==0),this.$el.find(".status-length-left").text(256-n.length)}});return n})