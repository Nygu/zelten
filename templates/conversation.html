{% extends app.request.isXmlHttpRequest ? "ajax.html" : "layout.html" %}

{% block title %}Conversation of {{ post.entity.name }}{% endblock %}

{% block content %}
<div class="conversation">
    {% if not app.request.isXmlHttpRequest() %}
        {% include "_message.html" with {'message': post} %}
    {% endif %}

    <div class="others">
    {% if parent %}
        <h6>In reply to</h6>
        {% include "_conversation_message.html" with {"message": parent} %}
    {% endif %}

    {% if comments.messages|length > 0 %}
        <h6>Comments</h6>
        {% for message in comments.messages %}
        {% include "_conversation_message.html" with {"message": message} %}
        {% endfor %}
    {% endif %}
    </div>
</div>
{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="/js/stream.js"></script>
<script type="text/javascript">
    var app = new Zelten.ConversationView({
        el: $(".conversation")
    });
    app.render();
</script>
{% endblock %}
